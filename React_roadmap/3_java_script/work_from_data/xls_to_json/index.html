<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>

</head>


<!--     LINK ON TOOTORIALL EXAMPLE

https://stackoverflow.com/questions/28782074/excel-to-json-javascript-code      

https://drbrain.ru/articles/convert-excel-to-json-with-javascript/

https://overcoder.net/q/47099/%D0%BA%D0%B0%D0%BA-%D1%80%D0%B0%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D1%82%D1%8C-%D1%84%D0%B0%D0%B9%D0%BB-excel-%D0%B2-javascript-html5

    
    
-->










<body>

    <input type="file" id="my_file_input" />
    <table id='my_file_output'></table> 

    <Script>
        
        var oFileIn;
        let trrrr = [];

$(function() {
    oFileIn = document.getElementById('my_file_input');
    if(oFileIn.addEventListener) {
        oFileIn.addEventListener('change', filePicked, false);
    }
});


function filePicked(oEvent) {



    
    // Get The File From The Input
    var oFile = oEvent.target.files[0];
    var sFilename = oFile.name;
    // Create A File Reader HTML5
    var reader = new FileReader();

    
    // Ready The Event For When A File Gets Selected
    reader.onload = function(e) {
        var data = e.target.result;
        var cfb = XLS.CFB.read(data, {type: 'binary'});
        var wb = XLS.parse_xlscfb(cfb);
        // Loop Over Each Sheet
        wb.SheetNames.forEach(function(sheetName) {
            // Obtain The Current Row As CSV
            var sCSV = XLS.utils.make_csv(wb.Sheets[sheetName]); 

            var data = XLS.utils.sheet_to_json(wb.Sheets[sheetName], {header:1});  

            $.each(data, function( indexR, valueR ) {
                var sRow = "<tr>";

                $.each(data[indexR], function( indexC, valueC ) {
                    sRow = sRow + "<td>" + valueC + "</td>";
                });

                sRow = sRow + "</tr>";
                $("#my_file_output").append(sRow);
            });
            



            data.forEach(it => {

                // console.log(it[0])
                let b = it[0]




                b = b.replace("Øíåêîâà ñï³ðàëü", "Шнекова спіраль")
                b = b.replace("Ê³ë-òü", "Кількість")
                b = b.replace("ÏÍ", "ПН")
                
                b = b.replace(/[é öóêåíãøùçõ¿ô³âàïðîëäæºÿ÷ñìèòüáþ*a-sl-´]/gi, "_")

                //  символи проблемної кодіровки éöóêåíãøùçõ¿ô³âàïðîëäæºÿ÷ñìèòüáþ´ÉÖÓÊÅÍÃØÙÇÕ¯Ô²ÂÀÏÐÎËÄÆªß×ÑÌÈÒÜÁÞ   йцукенгшщзхїфівапролджєячсмитьбюґЙЦУКЕНГШЩЗХЇФІВАПРОЛДЖЄЯЧСМИТЬБЮ



                

                b = b.replace("[", "_")
                b = b.replace("]", "_")
                b = b.replace("{", "_")
                b = b.replace("}", "_")


                for(i= 0; i<4; i++){
                    b = b.replace("-", "_")
                }



                // виключення для ячейок які включають дату
                if (b.includes('_Шнекова_спіраль')){
                    b = b.replace("(", "_")
                    b = b.replace(")", "_")
                    b = b.replace(/[.]/gi, ",")
                }




                for(i= 0; i<20; i++){
                    b = b.replace("__", "_")
                }
                
                
                b = b.replace("_Шнекова_спіраль", "Cпіраль ")


                if (b[0]='_'){
                    b = b.replace("_", "")
                }

                b = b.replace(",,", " ")
                b = b.replace(" , ", " ")
                b = b.replace(/[_]/g, " ")

                for(i= 0; i<20; i++){
                    b = b.replace("  ", " ")
                }

                b = b.split(" ")

                b = b.filter((n) => {return n != ","});

                let itishechka =[]
                
                for(i=0; i < it.length; i++){
                    if (i==0){
                        itishechka.push(b)
                    }
                    if (i !== 0){
                        itishechka.push(it[i])
                    }    
                }



                // обєднання даних для таблиці

                let itishechka2 =[]

                for(i=0; i < itishechka.length; i++){
                    if (i==0){
                        let tempr  = itishechka[i].join(' ')
                        itishechka2.push(tempr)
                        tempr = ""
                    }
                    if (i !== 0){
                        itishechka2.push(itishechka[i])
                    }    
                }

              


                console.log(itishechka2)
                b=""
                itishechka = []
                itishechka2 = []

                

            })

    
            
            
        });
    };
    
    // Tell JS To Start Reading The File.. You could delay this if desired
    reader.readAsBinaryString(oFile);
}

    </Script>
 


    <!-- <script>
        var ExcelToJSON = function() {

            this.parseExcel = function(file) {
                var reader = new FileReader();

                reader.onload = function(e) {
                    var data = e.target.result();
                    var workbook = XLSX.read(data, {
                    type: 'binary'
                    });

                    workbook.SheetNames.forEach(function(sheetName) {
                    // Here is your object
                    var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
                    var json_object = JSON.stringify(XL_row_object);
                    console.log(json_object);

                    })

                };

                reader.onerror = function(ex) {
                    console.log(ex);
                };

                reader.readAsBinaryString(file);
            };
        };
    </script> -->

</body>
</html>